{% extends 'base.html' %}
{% block title %}Revenue Analytics | UzhavanGo{% endblock %}
{% block content %}
<section class="dashboard-header">
    <h1>Revenue Analytics</h1>
    <p>Daily, weekly, monthly and contribution analysis.</p>
</section>

<section class="kpi-grid">
    <article class="card"><h3>Daily Revenue Points</h3><p class="kpi">{{ daily|length }}</p></article>
    <article class="card"><h3>Weekly Revenue Points</h3><p class="kpi">{{ weekly|length }}</p></article>
    <article class="card"><h3>Monthly Revenue Points</h3><p class="kpi">{{ monthly|length }}</p></article>
    <article class="card"><h3>Booking Growth Points</h3><p class="kpi">{{ growth|length }}</p></article>
</section>

<section class="grid-2">
    <article class="card"><h3>Revenue Growth Trend</h3><canvas id="growthChart" height="170"></canvas></article>
    <article class="card"><h3>Revenue per Tractor</h3><canvas id="tractorChart" height="170"></canvas></article>
</section>
<section class="grid-2">
    <article class="card"><h3>Revenue per Owner</h3><canvas id="ownerChart" height="170"></canvas></article>
    <article class="card"><h3>Weekly Revenue</h3><canvas id="weeklyChart" height="170"></canvas></article>
</section>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const growthLabels = {{ growth|map(attribute='period')|list|tojson }};
const growthVals = {{ growth|map(attribute='bookings')|list|tojson }};
const tractorLabels = {{ by_tractor|map(attribute='name')|list|tojson }};
const tractorVals = {{ by_tractor|map(attribute='revenue')|list|tojson }};
const ownerLabels = {{ by_owner|map(attribute='name')|list|tojson }};
const ownerVals = {{ by_owner|map(attribute='revenue')|list|tojson }};
const weeklyLabels = {{ weekly|map(attribute='period')|list|tojson }};
const weeklyVals = {{ weekly|map(attribute='revenue')|list|tojson }};

new Chart(document.getElementById('growthChart'), {
  type: 'line',
  data: { labels: growthLabels, datasets: [{ label: 'Bookings', data: growthVals, borderColor: '#0A7F3F', tension: 0.3 }] }
});
new Chart(document.getElementById('tractorChart'), {
  type: 'bar',
  data: { labels: tractorLabels, datasets: [{ label: 'Revenue', data: tractorVals, backgroundColor: '#111111' }] }
});
new Chart(document.getElementById('ownerChart'), {
  type: 'bar',
  data: { labels: ownerLabels, datasets: [{ label: 'Revenue', data: ownerVals, backgroundColor: '#0A7F3F' }] }
});
new Chart(document.getElementById('weeklyChart'), {
  type: 'line',
  data: { labels: weeklyLabels, datasets: [{ label: 'Weekly Revenue', data: weeklyVals, borderColor: '#111111', tension: 0.3 }] }
});
</script>
{% endblock %}
